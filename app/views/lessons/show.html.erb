<!-- first div with general info + btn to start lesson -->

<% unless @validated || @skipped %>
  <% if @open_to_unblock %>
    <%= render template: 'lesson_validations/new' %>
    <%= render template: 'lesson_unblocks/new' %>
    <%= render 'unblock_recipe_popup' %>
  <% else %>
    <%= render template: 'lesson_validations/new' %>
  <% end %>
<% end %>

<% if @skipped %>
  <%= render template: 'lesson_validations/edit' %>
<% end %>

<%= render 'shared/help' %>


<div class="container-lesson-overview">

  <div class="lesson-overview-navbar">
    <%= link_to book_path(@lesson.book) do %>
      <%= image_tag('btn-back.svg') %>
    <% end %>
    <h1><%= @lesson.title %></h1>
    <%= image_tag('btn-help.svg', id: 'openHelpBtn') %>
  </div>

  <div class="lesson-overview-content">

    <div class="lesson-overview-skillchapters">
      <h1>Watch Skill Chapters</h1>
      <h2>Bite-sized learnings on-the-go</h2>

      <div class="lesson-overview-skillchapters-cards <%= @lesson.skill_chapters.count > 1 ? "sp-around" : "fx-start" %>">
        <% @lesson.skill_chapters.each do |skill_chapter| %>
        <div class="lesson-overview-skill-card">
          <div class="badge-container">
            <%= image_tag("#{skill_chapter.badge.white}", class: 'badge1') %>
            <%= image_tag("#{skill_chapter.badge.icon}", class: 'badge2') %>
          </div>
          <p class="skill-p"><%= skill_chapter.title %></p>
        </div>
        <% end %>
      </div>
    </div>

    <div class="lesson-overview-recipes">
      <h1>Cook One Practice Recipe</h1>
      <h2>Choose a recipe to prepare</h2>

      <div class="lesson-overview-recipes-cards">
        <% @lesson.recipes.each do |recipe| %>
        <div class="lesson-overview-recipe-card">
          <%= link_to recipe_path(recipe) do %>
            <div class="lesson-overview-recipe-image" style="background-image: linear-gradient(rgba(0,0,0,.5), rgba(0,0,0,0)), url('<%= image_path("#{recipe.photo_url}") %>')">
            </div>
          <% end %>
          <h3><%= recipe.title %></h3>
        </div>
        <% end %>
      </div>
    </div>

    <div class="lesson-overview-validation">
      <h1>Complete the Lesson</h1>
      <h2>Pics of the finished recipe or it did not happen!</h2>

      <div class="lesson-overview-validation-cards">
        <div class="lv-card without-photo mr-1">
          <%= image_tag('lv-input-nophoto.svg') %>
          <p>Ups, I already ate it</p>
        </div>
        <div class="lv-card with-photo ml-1">
          <%= image_tag('lv-input-photo.svg') %>
          <p>Upload a photo</p>
        </div>
      </div>
    </div>

  </div>
</div>


<div class="skill-chapters">
  <% @lesson.skill_chapters.order(:id).each_with_index do |skill_chapter, index| %>

    <div class="container-lesson-chapter">
      <div class="lesson-skill-video">
        <video class="skillVideo" src="<%= skill_chapter.video_url %>" controls playsinline></video>
      </div>

      <div class="card-lesson-chapter">
        <%= image_tag('lesson-dash.svg', class: 'card-dash') %>
        <h2 class="text-center"><%= skill_chapter.title %></h2>
        <h3>Transcription</h3>

        <div class="skill-description-container">
          <p class="skill-description"><%= skill_chapter.description %></p>
        </div>

        <% unless @lesson.skill_chapters.last == skill_chapter  %>
          <p class="primary-btn lesson-next-btn" style="cursor: pointer;">Next video</p>
        <% else %>
          <p class="primary-btn" style="cursor: pointer;" id="startRecipe">Ready to Cuuk!</p>
        <% end %>
      </div>
    </div>

  <% end %>
</div>
